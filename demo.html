<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<title>Electric Nose</title>
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" 
			integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" 
			crossorigin="anonymous">
	</head>
	<body>
		<nav class="navbar navbar-expand-sm bg-dark justify-content-center">
			<ul class="navbar-nav">
				<li>
					<h2 class="text-white">Electric Nose</h2>
				</li>
			</ul>
		</nav>
		<div class="container pt-3">
			<div class="row">
				<div class="col">
						<div class="card">	
							<div class="card-header font-weight-bold">Current Sensor Readings</div>
							<div class="card-body">
								<div class="row">
									<div class="col">
										<p class="card-text">Temperature: </p>
										<p class="card-text">Humidity: </p>
										<p class="card-text">Air Pressure: </p>
										<p class="card-text">Soot: </p>
										<button class="btn btn-dark" onclick="loadSensorData()">Reload</button>
									</div>
									<div class="col">
										<p class="card-text" id="temp"></p>
										<p class="card-text" id="hum"></p>
										<p class="card-text" id="press"></p>
										<p class="card-text" id="soot"></p>
										
									</div>
								</div>	
							</div>
						</div>
				</div>
				<div class="col">
						<div class="card">	
							<div class="card-header font-weight-bold">Last 7 Days Average Temperature Data</div>
							<div class="card-body">
								<canvas id="myChart" width="200" height="200"></canvas>
							</div>
						</div>
				</div>
		</div>
	</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.bundle.js" 
		integrity="sha512-zO8oeHCxetPn1Hd9PdDleg5Tw1bAaP0YmNvPY8CwcRyUk7d7/+nyElmFrB6f7vg4f7Fv4sui1mcep8RIEShczg==" 
		crossorigin="anonymous"></script>
		<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" 
			integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" 
			crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js" 
			integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx" 
			crossorigin="anonymous"></script>	
			
			
		<script>
		window.onload=loadDoc;
		
		
		function loadDoc(){
			var xhttp=new XMLHttpRequest();
			xhttp.open("GET","/ajax-info",true);
			xhttp.onreadystatechange=function(){
				if(this.readyState==4 && this.status==200){
					var jsonObj=JSON.parse(this.responseText);
					document.getElementById("temp").innerHTML=jsonObj.liveData.temperature;
					document.getElementById("hum").innerHTML=jsonObj.liveData.humidity;
					document.getElementById("press").innerHTML=jsonObj.liveData.pressure;
					document.getElementById("soot").innerHTML=jsonObj.liveData.soot;
					dateData=[];
					tempData=[];
					for(i=0;i<jsonObj.avgTempData.length;i++){
						dateData.push(jsonObj.avgTempData[i]["t"]);
						tempData.push(jsonObj.avgTempData[i]["avgTemp"]);
						
					}
					console.log(dateData);
					console.log(tempData);
					
					var ctx = document.getElementById('myChart').getContext('2d');
					var myChart = new Chart(ctx, {
					type: 'bar',
					data: {
						labels: dateData,
						datasets: [{
							label: 'Average Daily Temperature',
							data: tempData,
						
							backgroundColor: [
								'rgba(255, 99, 132, 0.6)',
								'rgba(54, 162, 235, 0.6)',
								'rgba(255, 206, 86, 0.6)',
								'rgba(75, 192, 192, 0.6)',
								'rgba(153, 102, 255, 0.6)',
								'rgba(255, 159, 64, 0.6)',
								'rgba(255, 99, 132, 0.6)'
							],
							borderColor: [
								'rgba(255, 99, 132, 1)',
								'rgba(54, 162, 235, 1)',
								'rgba(255, 206, 86, 1)',
								'rgba(75, 192, 192, 1)',
								'rgba(153, 102, 255, 1)',
								'rgba(255, 159, 64, 1)',
								'rgba(255, 99, 132, 1)'
							],
							borderWidth: 1
						}]
					},
					options: {
						scales: {
							yAxes: [{
								ticks: {
									beginAtZero: true
								}
							}]
						}
					}
				});
		
			
					
					
					}
				}
			
			
			
			xhttp.send(null);
		}
		
		function loadSensorData(){
			var xhttp=new XMLHttpRequest();
			xhttp.open("GET","/ajax-info",true);
			xhttp.onreadystatechange=function(){
				if(this.readyState==4 && this.status==200){
					var jsonObj=JSON.parse(this.responseText);
					document.getElementById("temp").innerHTML=jsonObj.liveData.temperature;
					document.getElementById("hum").innerHTML=jsonObj.liveData.humidity;
					document.getElementById("press").innerHTML=jsonObj.liveData.pressure;
					document.getElementById("soot").innerHTML=jsonObj.liveData.soot;
					
					
				}
			}
			
			
			
			xhttp.send(null);
		}
		
	
		
	
		</script>
		
		
	</body>
</html>